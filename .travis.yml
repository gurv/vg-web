language: node_js
node_js:
- '10'
dist: trusty
sudo: required
branches:
  only:
  - master
addons:
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable
services:
- docker
before_script:
- npm install -g @angular/cli
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
script:
- ng test --watch=false --no-progress --browsers=ChromeHeadlessNoSandbox
- ng e2e
- ng lint
- npm run sonar
- ng build --output-path=last-build/ --configuration=production --base-href https://gurv.github.io/vg/
- docker image build -t gurv/web .
after_success:
- docker login -u="$CI_DOCKER_USERNAME" -p="$CI_DOCKER_PASSWORD"
- docker push gurv/web:latest
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  local_dir: last-build/
  on:
    branch: master
notifications:
  slack:
    secure: au0jv4k8UypJ+MEu4rFavgQ2G7p6TXYj7VOGh5TQeYaUeK7epHgJzNLoMgbvALlNWZkLDoBHkQO2YF1Vh1ozF1HenO8EXqof9wFXiAej/wd3PO05jcjamqRP1onRHiWx6vWxPqpGJDI3RpRgmnJuUIxmIH1JTbzK6hgGeDYZMqZN9l4RGQHkBF6dDw37Fco6u60QIK43Pl/DoGoTs91J3ZF+or/aBE5SMQdFR7WRIN/c3E0gwLxkDRdZGbdRoHAqh08MXUrXUMkKIWk1TYnvhCdy8AdUh3y1T2KsNi6FiHdF6UuBqu6RXkKn4L7sWRoMxJvcP4FDZwlug8GP296nozjznPeJeH6+90iNvpUFe6PSyYBaC2CTEZUlVZsgvUII+YUaI+oAt4zEmKLkT/eH74lAx5vXo7cU8vYNUebXmblKRXQWTEIaRQ6KjDwvJ7PYxboQavGcs/VdzNHowfod+1BWGGqi3tEUd04a+lXrONb9xlNg1hg5RjnFroIgkZH1tZgr4p3BqTXnwwzuY2S5JnQ05og4NqtAKDVy2AhfDUhT/Kp5IK7lAJ0svJYNxxfSVHvk1g8Tm+yI2QRoVH1SIqbPE8et6QpVDQdwO6f9/1i/DjnW8ZwWDfasO1/5LsxycTqsc9YokOqcw/+9q0XrnwnlLRaTgWsVxeCmLh4dYoQ=
